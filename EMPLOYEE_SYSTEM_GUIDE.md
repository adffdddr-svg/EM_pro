# ุฏููู ูุธุงู ุงูููุธููู ูุงููุฏูุฑูู
## Employee & Admin System Guide

---

## โ ูุง ุชู ุชูููุฐู

### 1. ูุธุงู Remember Me (ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ูุงุญุฏุฉ)
- โ ุฅุถุงูุฉ checkbox "ุชุฐูุฑูู" ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ ุญูุธ Token ูู Cookie ููุฏุฉ 30 ููู
- โ ุญูุธ Token ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (`user_remember_tokens`)
- โ ุชุณุฌูู ุฏุฎูู ุชููุงุฆู ุนูุฏ ูุชุญ ุงููููุน

### 2. ุฑุจุท ุงูููุธููู ุจุงููุณุชุฎุฏููู
- โ ุฅุถุงูุฉ `user_id` ุฅูู ุฌุฏูู `employees`
- โ ุฏุงูุฉ `getEmployeeByUserId()` ููุญุตูู ุนูู ูุนูููุงุช ุงูููุธู

### 3. ูุงุฌูุฉ ุงูููุธู
- โ ุตูุญุฉ `employee/profile.php` - ุงูููู ุงูุดุฎุตู ููููุธู
- โ ุนุฑุถ ูุนูููุงุช ุงูููุธู ุงูุดุฎุตูุฉ ูุงููุธูููุฉ
- โ ุฑุงุจุท ููุจูุช ุงูุฐูู
- โ ุนุฑุถ ุฑุณุงุฆู ุงูุจูุช ุงูุฃุฎูุฑุฉ

### 4. ูุงุฌูุฉ ุงููุฏูุฑ
- โ ุชูุฌูู ุงูููุธู ุชููุงุฆูุงู ุฅูู ุตูุญุฉ ุงูููู ุงูุดุฎุตู
- โ ุงููุฏูุฑ ูุฑู ููุญุฉ ุงูุชุญูู ุงููุงููุฉ
- โ ุงูุจูุช ูุณุงุนุฏ ุงููุฏูุฑ ูู ุงูุฅุญุตุงุฆูุงุช

### 5. ุงูุจูุช ุงูุฐูู
- โ ุจูุช ูุฎุชูู ูููุฏูุฑ ูุงูููุธู
- โ ููููุธู: ุฃุณุฆูุฉ ุนู ุฑุงุชุจู ูุฅุฌุงุฒุงุชู
- โ ูููุฏูุฑ: ุฃุณุฆูุฉ ุนู ุงูุฅุญุตุงุฆูุงุช (ูุซู "ูู ุฃูุซุฑ ููุธู ุฃุฎุฐ ุฅุฌุงุฒุฉ")

### 6. ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
- โ ุฑูุงุจุท ูุฎุชููุฉ ุญุณุจ ุงูุฏูุฑ
- โ ุงูููุธู ูุฑู: ุงูููู ุงูุดุฎุตู + ุงูุจูุช
- โ ุงููุฏูุฑ ูุฑู: ููุญุฉ ุงูุชุญูู + ุงูููุธููู + ุงูุฃุฑุดูู + ุงูุจูุช

---

## ๐ ุฎุทูุงุช ุงูุชุซุจูุช

### ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู ุจุชุดุบูู ููู SQL ุงูุชุงูู ูู phpMyAdmin:

```sql
-- ููู: database/update_for_employee_system.sql
```

ุฃู ูู ุจุชุดุบูู ุงูุฃูุงูุฑ ุงูุชุงููุฉ ูุฏููุงู:

```sql
USE employee_management;

-- 1. ุฅูุดุงุก ุฌุฏูู Remember Tokens
CREATE TABLE IF NOT EXISTS user_remember_tokens (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    token VARCHAR(64) NOT NULL UNIQUE,
    expires_at DATETIME NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_token (token),
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 2. ุฅุถุงูุฉ user_id ุฅูู ุฌุฏูู employees
ALTER TABLE employees 
ADD COLUMN IF NOT EXISTS user_id INT NULL AFTER id;

-- 3. ุฅุถุงูุฉ Foreign Key
ALTER TABLE employees 
ADD CONSTRAINT fk_employees_user_id 
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL;

-- 4. ุฅุถุงูุฉ Index
ALTER TABLE employees 
ADD INDEX idx_user_id (user_id);
```

### ุงูุฎุทูุฉ 2: ุฑุจุท ุงูููุธููู ุจุงููุณุชุฎุฏููู

ุจุนุฏ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูุฌุจ ุฑุจุท ูู ููุธู ุจู `user_id`:

```sql
-- ูุซุงู: ุฑุจุท ููุธู ุจูุนุฑู ูุณุชุฎุฏู
UPDATE employees SET user_id = 1 WHERE id = 1;
```

**ููุงุญุธุฉ:** ูุฌุจ ุฃู ูููู `user_id` ููุฌูุฏุงู ูู ุฌุฏูู `users`.

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงููุธุงู

1. **ุงุฎุชุจุงุฑ Remember Me:**
   - ุณุฌู ุฏุฎูู ูููุธู ุฃู ูุฏูุฑ
   - ุงุฎุชุฑ "ุชุฐูุฑูู"
   - ุฃุบูู ุงููุชุตูุญ
   - ุงูุชุญ ุงููููุน ูุฑุฉ ุฃุฎุฑู โ ูุฌุจ ุฃู ูุณุฌู ุฏุฎูู ุชููุงุฆูุงู

2. **ุงุฎุชุจุงุฑ ูุงุฌูุฉ ุงูููุธู:**
   - ุณุฌู ุฏุฎูู ูููุธู (role = 'employee')
   - ูุฌุจ ุฃู ูุชู ุชูุฌููู ุชููุงุฆูุงู ุฅูู `/employee/profile.php`
   - ุชุญูู ูู ุนุฑุถ ูุนูููุงุชู ุงูุดุฎุตูุฉ

3. **ุงุฎุชุจุงุฑ ูุงุฌูุฉ ุงููุฏูุฑ:**
   - ุณุฌู ุฏุฎูู ููุฏูุฑ (role = 'admin')
   - ูุฌุจ ุฃู ุชุฑู ููุญุฉ ุงูุชุญูู ุงููุงููุฉ
   - ุฌุฑุจ ุงูุจูุช: "ูู ุฃูุซุฑ ููุธู ุฃุฎุฐ ุฅุฌุงุฒุฉ ูุฐุง ุงูุดูุฑุ"

---

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
- `employee/profile.php` - ุตูุญุฉ ุงูููู ุงูุดุฎุตู ููููุธู
- `database/update_for_employee_system.sql` - SQL ููุชุญุฏูุซ

### ูููุงุช ูุญุฏุซุฉ:
- `includes/auth.php` - ุฅุถุงูุฉ Remember Me
- `includes/functions.php` - ุฅุถุงูุฉ `getEmployeeByUserId()`
- `includes/header.php` - ุงุณุชุฏุนุงุก `checkRememberToken()`
- `includes/sidebar.php` - ุฑูุงุจุท ูุฎุชููุฉ ุญุณุจ ุงูุฏูุฑ
- `auth/login.php` - ุฅุถุงูุฉ checkbox Remember Me
- `admin/dashboard.php` - ุชูุฌูู ุงูููุธู
- `bot/index.php` - ุจูุช ูุฎุชูู ุญุณุจ ุงูุฏูุฑ
- `bot/api_simple.php` - ูุนุงูุฌุฉ ุฃุณุฆูุฉ ุงููุฏูุฑ

---

## ๐ ุงุณุชุฎุฏุงู ุงููุธุงู

### ููููุธู:
1. ุณุฌู ุฏุฎูู โ ูุชู ุชูุฌููู ุชููุงุฆูุงู ุฅูู ุงูููู ุงูุดุฎุตู
2. ูู ุงูููู ุงูุดุฎุตู:
   - ุดุงูุฏ ูุนูููุงุชู ุงูุดุฎุตูุฉ ูุงููุธูููุฉ
   - ุงุถุบุท ุนูู "ูุชุญ ุงูุจูุช ุงูุฐูู" ููุงุณุชูุณุงุฑ ุนู:
     - ุฑุงุชุจู
     - ุฅุฌุงุฒุงุชู
     - ูุนูููุงุชู ุงูุดุฎุตูุฉ

### ูููุฏูุฑ:
1. ุณุฌู ุฏุฎูู โ ุชุฑู ููุญุฉ ุงูุชุญูู
2. ุงุณุชุฎุฏู ุงูุจูุช ููุงุณุชูุณุงุฑ ุนู:
   - "ูู ุฃูุซุฑ ููุธู ุฃุฎุฐ ุฅุฌุงุฒุฉ ูุฐุง ุงูุดูุฑุ"
   - "ูู ุนุฏุฏ ุงูููุธููู ุงููุดุทููุ"
   - "ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูููุธููู"
   - "ูู ุงูููุธููู ุงูุฌุฏุฏ ูุฐุง ุงูุดูุฑุ"

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุฑุจุท ุงูููุธููู:** ูุฌุจ ุฑุจุท ูู ููุธู ุจู `user_id` ูู ุฌุฏูู `employees` ุญุชู ูุนูู ุงููุธุงู ุจุดูู ุตุญูุญ.

2. **Remember Me:** ูุนูู ููุท ุฅุฐุง ูุงู ุฌุฏูู `user_remember_tokens` ููุฌูุฏุงู. ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ุณูุชู ุชุฌุงูู ุงูุฎุทุฃ ูููู ูู ูุนูู Remember Me.

3. **ุงูุจูุช ูููุฏูุฑ:** ุงููุฏูุฑ ููุณ ููุธูุงูุ ูุฐูู `employee_id = null` ูููุฏูุฑ. ุงูุจูุช ูุนุงูุฌ ุฃุณุฆูุฉ ุงููุฏูุฑ ุจุดูู ุฎุงุต.

4. **ุงูุฃูุงู:** Remember Token ูุชู ุญูุธู ุจุดูู ุขูู ูู Cookie ูุน HttpOnly flag.

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: ุงูููุธู ูุง ูุฑู ูููู ุงูุดุฎุตู
**ุงูุญู:** ุชุฃูุฏ ูู ุฑุจุท `user_id` ูู ุฌุฏูู `employees`:
```sql
SELECT * FROM employees WHERE user_id IS NULL;
UPDATE employees SET user_id = ? WHERE id = ?;
```

### ุงููุดููุฉ: Remember Me ูุง ูุนูู
**ุงูุญู:** ุชุฃูุฏ ูู ุฅูุดุงุก ุฌุฏูู `user_remember_tokens`:
```sql
SHOW TABLES LIKE 'user_remember_tokens';
```

### ุงููุดููุฉ: ุงูุจูุช ูุง ูุฌูุจ ุนูู ุฃุณุฆูุฉ ุงููุฏูุฑ
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู `isAdmin()` ูุนูุฏ `true`:
```php
// ูู ุฃู ุตูุญุฉ
var_dump($_SESSION['role']); // ูุฌุจ ุฃู ูููู 'admin'
```

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉุ ุชุญูู ูู:
1. ููู `error_log` ูู ุงูุณูุฑูุฑ
2. Console ูู ุงููุชุตูุญ (F12)
3. ุชุฃูุฏ ูู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ุชุฃูุฏ ูู ุฑุจุท ุงูููุธููู ุจู `user_id`

---

**ุชู ุงูุชุญุฏูุซ:** <?php echo date('Y-m-d H:i:s'); ?>

