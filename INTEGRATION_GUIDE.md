# ุฏููู ุฏูุฌ ูุธุงู Chatbot ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู

## โ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุฅูุดุงุก ูุธุงู Chatbot ูุงูู ุจุงุณุชุฎุฏุงู OpenAI GPT-4o-mini ูุน ุงูููุฒุงุช ุงูุชุงููุฉ:

1. โ **OpenAI API Integration** (`bot/openai_api.php`)
2. โ **API Endpoint ูุญุฏุซ** (`bot/api.php`)
3. โ **Query Execution** (`bot/run_query.php`)
4. โ **ูุธุงู Fallback** (Rule-Based ุนูุฏ ูุดู OpenAI)
5. โ **ุญูุธ ุงููุญุงุฏุซุงุช** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

```
EM_pro/
โโโ bot/
โ   โโโ openai_api.php      # ูุฆุฉ OpenAI API
โ   โโโ run_query.php       # ุชูููุฐ SQL Queries
โโโ config/
โ   โโโ openai_key.txt      # ููู API Key (ุฃูุดุฆู ูุฏููุงู)
โโโ test_openai.php         # ุตูุญุฉ ุงุฎุชุจุงุฑ
โโโ OPENAI_SETUP.md         # ุฏููู ุงูุฅุนุฏุงุฏ
โโโ INTEGRATION_GUIDE.md    # ูุฐุง ุงูููู
```

## ๐ง ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### 1. ุงูุญุตูู ุนูู OpenAI API Key

1. ุงุฐูุจ ุฅูู: https://platform.openai.com/api-keys
2. ุณุฌู ุงูุฏุฎูู ุฃู ุฃูุดุฆ ุญุณุงุจ
3. ุงุถุบุท "Create new secret key"
4. ุงูุณุฎ ุงูู API Key

### 2. ุฅุถุงูุฉ API Key

**ุงูุทุฑููุฉ 1 (ููุตู ุจู):**
```bash
# ุฃูุดุฆ ููู config/openai_key.txt
# ุถุน API Key ููุท (ุจุฏูู ูุณุงูุงุช)
sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**ุงูุทุฑููุฉ 2:**
ุงูุชุญ `config/config.php` ูุฃุฒู ุงูุชุนููู:
```php
define('OPENAI_API_KEY', 'sk-your-api-key-here');
```

### 3. ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏ

ุงูุชุญ ูู ุงููุชุตูุญ:
```
http://localhost/EM_pro/test_openai.php
```

ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ.

## ๐ฏ ููููุฉ ุงูุนูู

### ุชุฏูู ุงูุนูููุฉ:

```
ุงููุณุชุฎุฏู ููุชุจ ุฑุณุงูุฉ
    โ
bot/api.php (handleProcessMessage)
    โ
OpenAIAPI->chat()
    โ
OpenAI GPT-4o-mini
    โ
AI ููุชุฑุญ SQL Query (ุฅุฐุง ูุฒู)
    โ
executeSuggestedQuery() (ุชูููุฐ Query)
    โ
AI ูุตูุบ ุฑุฏ ููุงุฆู ุจุงูููุฌุฉ ุงูุนุฑุงููุฉ
    โ
ุฅุฑุฌุงุน ุงูุฑุฏ ูููุณุชุฎุฏู
```

### ูุซุงู ูุงูู:

**ุงููุณุชุฎุฏู:** "ุดูุฏ ุฑุตูุฏู ูู ุงูุฅุฌุงุฒุงุชุ"

**AI ููุชุฑุญ:**
```sql
SELECT remaining_leave FROM employees WHERE id = 1
```

**ุชูููุฐ Query:**
```json
{
  "success": true,
  "data": [{"remaining_leave": 15}],
  "count": 1
}
```

**AI ูุตูุบ ุฑุฏ:**
"ุฑุตูุฏู ูู ุงูุฅุฌุงุฒุงุช 15 ููู ูุชุจูู. ุฅุฐุง ุชุฑูุฏ ุชุทูุจ ุฅุฌุงุฒุฉุ ูููู ุฃุณุงุนุฏู!"

## ๐ ุฏูุฌ ูุน ุงููุงุฌูุฉ ุงูููุฌูุฏุฉ

### ุงููุงุฌูุฉ ุงูุญุงููุฉ ุชุนูู ุชููุงุฆูุงู!

ุงููุงุฌูุฉ ุงูููุฌูุฏุฉ ูู `bot/index.php` ู `assets/js/bot.js` ุชุนูู ูุน ุงููุธุงู ุงูุฌุฏูุฏ ุชููุงุฆูุงู ูุฃู:

1. โ `bot/api.php` ูุญุฏุซ ูุงุณุชุฎุฏุงู OpenAI
2. โ ููุณ ุงูู Endpoint: `bot/api.php?action=process`
3. โ ููุณ ุชูุณูู JSON Response

### ูุง ุญุงุฌุฉ ูุชุบููุฑ JavaScript!

ุงูููุฏ ุงูููุฌูุฏ ูู `assets/js/bot.js` ูุนูู ููุง ูู:

```javascript
fetch(this.apiUrl, {
    method: 'POST',
    body: `action=process&message=${encodeURIComponent(message)}`
})
```

## ๐ก๏ธ ุงูุฃูุงู

### ุญูุงูุฉ SQL Injection:

1. โ ููุท `SELECT` queries ูุณููุญุฉ
2. โ ููุน ุงููููุงุช ุงูุฎุทูุฑุฉ (DROP, DELETE, UPDATE, etc.)
3. โ ุงุณุชุจุฏุงู `employee_id` ุชููุงุฆูุงู
4. โ ุงุณุชุฎุฏุงู Prepared Statements

### ุญูุงูุฉ API Key:

1. โ ูุง ุชุฑูุน `config/openai_key.txt` ุฅูู GitHub
2. โ ุฃุถู ุฅูู `.gitignore`:
```
config/openai_key.txt
```

## ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:

- `bot_interactions` - ุญูุธ ุฌููุน ุงููุญุงุฏุซุงุช
- `bot_messages` - ุฑุณุงุฆู ุงูุจูุช
- `employees` - ุจูุงูุงุช ุงูููุธููู
- `users` - ุจูุงูุงุช ุงููุณุชุฎุฏููู
- `departments` - ุงูุฃูุณุงู

## ๐จ ุชุฎุตูุต Prompt

ููููู ุชุนุฏูู Prompt ูู `bot/openai_api.php`:

```php
private function buildSystemPrompt($employee_info) {
    $prompt = "ุฃูุช ูุณุงุนุฏ HR ุฐูู...";
    // ุนุฏู ููุง
}
```

## ๐ Fallback System

ุฅุฐุง ูุดู OpenAI (ูุง API Keyุ ุฎุทุฃ ูู ุงูุงุชุตุงูุ etc.):

- ุงููุธุงู ูุณุชุฎุฏู `bot/processor.php` (Rule-Based) ุชููุงุฆูุงู
- ุงููุณุชุฎุฏู ูุง ูุดุนุฑ ุจุฃู ูุฑู
- ุฌููุน ุงูููุฒุงุช ุงููุฏููุฉ ุชุนูู

## ๐ก ุฃูุซูุฉ ุนูู ุงูุฃุณุฆูุฉ

### ุฃุณุฆูุฉ ุจุณูุทุฉ:
- "ูุฑุญุจุง"
- "ุดููููุ"
- "ุดูุฏ ุงูููุชุ"

### ุฃุณุฆูุฉ ุนู ุงูุจูุงูุงุช:
- "ุดูุฏ ุฑุงุชุจูุ"
- "ูู ููุธู ูู ูุณู ITุ"
- "ุดููู ุญุงูุชู ุงููุธูููุฉุ"
- "ููู ูุณู ุงููุจูุนุงุชุ"

### ุฃุณุฆูุฉ ูุนูุฏุฉ:
- "ุฃุฑูุฏ ุฃุนุฑู ูู ุงูููุธููู ุงููู ุฑุงุชุจูู ุฃูุซุฑ ูู ููููู"
- "ูู ููุธู ุฌุฏูุฏ ุงูุถููุง ูุฐุง ุงูุดูุฑุ"
- "ุดููู ุฃุญุณุจ ุฑุงุชุจู ุจุนุฏ ุงูุฒูุงุฏุฉุ"

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: "OpenAI API Key ุบูุฑ ููุฌูุฏ"

**ุงูุญู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ `config/openai_key.txt`
2. ุฃู ุฃุถู ูู `config/config.php`
3. ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ูุณุงูุงุช ุฅุถุงููุฉ

### ุงููุดููุฉ: "Insufficient quota"

**ุงูุญู:**
- ุฑุตูุฏู ููุฐุ ุฃุถู ุฑุตูุฏ ูู ุญุณุงุจ OpenAI

### ุงููุดููุฉ: ุงูุจูุช ูุง ูุณุชุฌูุจ

**ุงูุญู:**
1. ุงูุชุญ `test_openai.php` ููุชุญูู
2. ุชุญูู ูู Console ูู ุงููุชุตูุญ (F12)
3. ุชุญูู ูู `error_log` ูู PHP

### ุงููุดููุฉ: Query ูุง ูุนูู

**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุงูู Query ูุจุฏุฃ ุจู `SELECT`
2. ุชุญูู ูู ุฃุณูุงุก ุงูุฌุฏุงูู ูุงูุฃุนูุฏุฉ
3. ุชุญูู ูู `employee_id` ูู ุงูู Query

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูุงููู:** ูู ุฑุณุงูุฉ ุชููู ุชูุฑูุจุงู $0.0001 - $0.001
2. **ุงูุณุฑุนุฉ:** GPT-4o-mini ุณุฑูุน ุฌุฏุงู (~1-3 ุซูุงูู)
3. **ุงูุญุฏูุฏ:** ูุง ุชูุฌุฏ ุญุฏูุฏ ุนูู ุนุฏุฏ ุงูุฑุณุงุฆู (ูุนุชูุฏ ุนูู ุฑุตูุฏู)
4. **ุงูุฎุตูุตูุฉ:** ุฌููุน ุงููุญุงุฏุซุงุช ุชูุญูุธ ูุญููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

1. ุฅุถุงูุฉ ุฏุนู ุงููููุงุช ูุงูุตูุฑ
2. ุฅุถุงูุฉ Voice Input/Output
3. ุฅุถุงูุฉ ุชุญูููุงุช ูููุญุงุฏุซุงุช
4. ุฅุถุงูุฉ Multi-language support
5. ุฅุถุงูุฉ Integration ูุน ุฃูุธูุฉ ุฎุงุฑุฌูุฉ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุฑุงุฌุน `OPENAI_SETUP.md`
2. ุงูุชุญ `test_openai.php` ููุงุฎุชุจุงุฑ
3. ุชุญูู ูู `error_log` ูู PHP

---

**ุชู ุฅูุดุงุก ุงููุธุงู ุจูุฌุงุญ! ๐**

ุงูุขู ุงูุจูุช ูุณุชุฎุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููููู ุงูููุฌุฉ ุงูุนุฑุงููุฉ ููุฌุงูุจ ุนูู ุฃู ุณุคุงู!

